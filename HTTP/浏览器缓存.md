# 浏览器缓存

## 强缓存

### Expires(HTTP/1.0)

说明：表示过期时间，即在``某个具体时间之前``可以从缓存中获取数据，存在于服务端返回的响应头中。

缺点：服务器时间和浏览器时间可能会不一致，导致过期时间不准确。

### Cache-Control(HTTP/1.1)

说明：表示过期时长，即在``一定时间内``可以从缓存中读取数据，存在于服务端返回的响应头中，对应的字段是``max-age``，单位是秒。

#### 组合使用的指令

``private``：只有浏览器能缓存，中间的代理服务器不能缓存。

``no-cache``：跳过当前的强缓存，进入协商缓存阶段。

``no-store``：不进行任何形式的缓存。

``s-maxage``：针对代理服务器的缓存时间。



``PS``：当``Expires``和``Cacha-Control``同时存在时，会有限考虑``Cache-Control``。

## 协商缓存

### Last-Modified

说明：表示最后修改时间，在浏览器第一次给服务器发送请求后，服务器在响应头上加上此字段；如果浏览器再次请求，会在请求头携带``If-Modified-Since``字段，此字段的值就是最后修改时间；服务器收到请求后，会和该资源的最后修改时间对比：

* 如果请求头中的值小于最后修改时间：返回新资源
* 否则，返回304，使用缓存

### Etag

说明：服务器更具当前文件内容生成唯一标识，文件内容有改动，该值就会变，服务器通过响应头将该值传给浏览器；浏览器会在下次请求时将此值存在请求头的``If-None-Match``中，服务器将``If-None-Match``和该资源的``Etag``对比：

* 两者不一致：返回新资源
* 否则，返回403，使用缓存

### Etag 和 Last-Modified 对比

* 在精准度上，``Etag ``优于 ``Last-Modified``。

* 在性能上，``Last-Modified``优于``Etag``。

## 缓存位置

* Service Worker(让JS运行在主线程之外)
* Memory Cache(内存缓存，速度快，存活时间短)
* Disk Cache(磁盘缓存，速度慢，容量大，存货时间长)
* Push Cache(HTTP/2，推送缓存，浏览器缓存的最后防线)